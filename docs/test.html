<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
    .bar {  }
    
  </style>
</head>

<body>
  <button id="byKey"> Sort by Key</button>
  <button id="byValue"> Sort by Value</button>
  <br>
  <script>

    var data = [
    {key: "Test 1",  value: 21},
    {key: "Test 2",  value: 34},
    {key: "Test 3",  value: 85},
    {key: "Test 4",  value: 41},
    {key: "Test 5",  value: 26},
    {key: "Test 6",  value: 46},
    {key: "Test 7",  value: 66},
    {key: "Test 8",  value: 77},
    {key: "Test 9",  value: 85},
    {key: "Test 10", value: 83},
    {key: "Test 11", value: 12},
    {key: "Test 12", value: 22},
    {key: "Test 13", value: 97}
];
    
var w = 700;
var h = 500;
var margin = {
    top: 50,
    bottom: 100,
    left: 30,
    right: 20
};
var width = w - margin.left - margin.right;
var height = h - margin.top - margin.bottom;
    
var x = d3.scaleBand()
        .domain(data.map(function(d){
            return d.key;
        }))
        .range([margin.left, width])
    		.padding(0.1);
    
var y = d3.scaleLinear()
        .domain([0, d3.max(data, function(d){
            return d.value;
        })])
				.range([height, margin.top])

var yAxis = d3.axisLeft().scale(y)
        

var svg = d3.select("body").append("svg")
            .attr("id", "chart")
            .attr("width", w)
            .attr("height", h);
    				
						svg.append("g")
						.attr("class","axis")
						.attr("transform","translate(" + margin.left + ",0)")
						.call(yAxis);
         

    svg.selectAll("rect")
        .data(data)
        .enter()
            .append("rect")
   					.attr("class","bar")
       			.on("mouseover",function(){
      				d3.select(this)
              	.attr("fill","red")
    				}) 				
    				.on("mouseout",function(){
      				d3.select(this)
              	.transition("colorfade")
								.duration(250)
    						.attr("fill",function(d){
      						return "rgb(" + Math.round(d.value*2) + "," 
                + Math.round(d.value*2) + "," + Math.round(d.value*2) + ")";})
    				}) 
    
    				.attr("fill",function(d){
      				return "rgb(" + Math.round(d.value*2) + "," 
                + Math.round(d.value*2) + "," + Math.round(d.value*2) + ")";})
    				    
            .attr("x", function(d,i){
               return x(d.key);
            })
    				.attr("width", x.bandwidth())    
    				.attr("y", height)   				
    				
						.transition("bars")
						.delay(function(d, i) {
							return i * 50;
						})
						.duration(1000)
    
     			  .attr("y", function(d,i){
               return y(d.value);
            })   				
            .attr("height", function(d,i){
      				return height-y(d.value);
    				})  
        				

   svg.selectAll("rect") 			
    				.append("title")
			   		.text(function(d) {
			   			return d.key + ": " + d.value;
			   		})
   


    svg.selectAll(".val-label")
        .data(data)
        .enter()
            .append("text")
            .classed("val-label", true)

            .attr("x", function(d,i){
                return x(d.key) + x.bandwidth()/2;
            })
    				.attr("y", height)   				
    				
						.transition("label")
						.delay(function(d, i) {
							return i * 50;  // gives it a smoother effect
						})
						.duration(1000)
    
     			  .attr("y", function(d,i){
                return y(d.value) - 4;
            })
    				.attr("text-anchor","middle")
    				.text(function(d){return d.value});
  
  	svg.selectAll(".bar-label")
            .data(data)
        		.enter()
            .append("text")
            .classed("bar-label", true)
    
						.attr("transform",function(d,i){
      				return "translate(" + (x(d.key) + x.bandwidth()/2 - 8 ) + "," + (height+15) + ")" 
              	+ " rotate(45)" })
    				 
      			.attr("text-anchor","left")
    				.text(function(d){return d.key})
    
    d3.select("#byKey").on("click", function() {
  data.sort(function(a, b) {
    return d3.ascending(a.key, b.key)
  })
  x.domain(data.map(function(d) {
    return d.key;
  }));
  svg.selectAll(".bar")
    .transition()
    .duration(500)
    .attr("x", function(d, i) {
      return x(d.key);
    })

  svg.selectAll(".val-label")
    .transition()
    .duration(500)
    .attr("x", function(d, i) {
      return x(d.key) + x.bandwidth() / 2;
    })

  svg.selectAll(".bar-label")
    .transition()
    .duration(500)
    .attr("transform", function(d, i) {
      return "translate(" + (x(d.key) + x.bandwidth() / 2 - 8) + "," + (height + 15) + ")" + " rotate(45)"
    })

})

d3.select("#byValue").on("click", function() {
  data.sort(function(a, b) {
    return d3.descending(a.value, b.value)
  })
  x.domain(data.map(function(d) {
    return d.key;
  }));
  svg.selectAll(".bar")
    .transition()
    .duration(500)
    .attr("x", function(d, i) {
      return x(d.key);
    })

  svg.selectAll(".val-label")
    .transition()
    .duration(500)
    .attr("x", function(d, i) {
      return x(d.key) + x.bandwidth() / 2;
    })

  svg.selectAll(".bar-label")
    .transition()
    .duration(500)
    .attr("transform", function(d, i) {
      return "translate(" + (x(d.key) + x.bandwidth() / 2 - 8) + "," + (height + 15) + ")" + " rotate(45)"
    })
})



  </script>
</body>




<!--
--><!--
--><!--
--><!--
--><!--
--><!--
--><!--
--><!--
--><!--
--><!--
-->



<!DOCTYPE html>
<style>

.axis .domain {
  display: none;
}

</style>
<svg width="960" height="500"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

var svg = d3.select("svg"),
    margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.top - margin.bottom,
    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var x = d3.scaleBand()
    .rangeRound([0, width])
    .paddingInner(0.05)
    .align(0.1);

var y = d3.scaleLinear()
    .rangeRound([height, 0]);

var z = d3.scaleOrdinal()
    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);
  
var xAxis = d3.axisBottom(x)
  
function update(data, keys) {
  data = [...data];
  const sortFn = (a, b) => d3.ascending(a.State, b.State);
  const xCopy = x.domain(data.sort(sortFn).map(d => d.State)).copy();
  const t = d3.transition().duration(750);
  const delay = (d, i) => i * 20;
  
  const groups = d3.selectAll("g.bar-group")
  	.data(d3.stack().keys(keys)(data))
  	.attr("fill", function(d) { return z(d.key); });
  
  const bars = groups.selectAll(".bar")
  	.data(d => d, d => d.data.State)
  	.sort((a, b) => xCopy(a.data.State) - xCopy(b.data.State))
  
  t.selectAll("g.bar-group")
  	.selectAll(".bar")
  	.delay(delay)
  	.attr("x", function(d) { return xCopy(d.data.State)})
  
  t.select(".axis.x")
  	.call(xAxis)
  	.selectAll("g")
  	.delay(delay)
}

d3.csv("data.csv", function(d, i, columns) {
  for (i = 1, t = 0; i < columns.length; ++i) t += d[columns[i]] = +d[columns[i]];
  d.total = t;
  return d;
}, function(error, data) {
  if (error) throw error;

  var keys = data.columns.slice(1);

  data.sort(function(a, b) { return b.total - a.total; });
  x.domain(data.map(function(d) { return d.State; }));
  y.domain([0, d3.max(data, function(d) { return d.total; })]).nice();
  z.domain(keys);

  g.append("g")
    .selectAll("g")
    .data(d3.stack().keys(keys)(data))
    .enter().append("g")
  		.classed("bar-group", true)
      .attr("fill", function(d) { return z(d.key); })
    .selectAll("rect")
    .data(function(d) { return d; }, d => d.data.State)
    .enter().append("rect")
  		.classed("bar", true)
      .attr("x", function(d) { return x(d.data.State); })
      .attr("y", function(d) { return y(d[1]); })
      .attr("height", function(d) { return y(d[0]) - y(d[1]); })
      .attr("width", x.bandwidth());

  g.append("g")
      .attr("class", "axis x")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  g.append("g")
      .attr("class", "axis y")
      .call(d3.axisLeft(y).ticks(null, "s"))
    .append("text")
      .attr("x", 2)
      .attr("y", y(y.ticks().pop()) + 0.5)
      .attr("dy", "0.32em")
      .attr("fill", "#000")
      .attr("font-weight", "bold")
      .attr("text-anchor", "start")
      .text("Population");

  var legend = g.append("g")
      .attr("font-family", "sans-serif")
      .attr("font-size", 10)
      .attr("text-anchor", "end")
    .selectAll("g")
    .data(keys.slice().reverse())
    .enter().append("g")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

  legend.append("rect")
      .attr("x", width - 19)
      .attr("width", 19)
      .attr("height", 19)
      .attr("fill", z);

  legend.append("text")
      .attr("x", width - 24)
      .attr("y", 9.5)
      .attr("dy", "0.32em")
      .text(function(d) { return d; });
  
  setTimeout(() => {
    update(data, keys)
  }, 1000)
});

</script>